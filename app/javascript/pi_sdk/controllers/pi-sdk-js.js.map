{"version":3,"file":"index.js","sources":["../../node_modules/async-mutex/index.mjs","../src/services/PiSdkBase.ts"],"sourcesContent":["const E_TIMEOUT = new Error('timeout while waiting for mutex to become available');\nconst E_ALREADY_LOCKED = new Error('mutex already locked');\nconst E_CANCELED = new Error('request for lock canceled');\n\nvar __awaiter$2 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Semaphore {\n    constructor(_value, _cancelError = E_CANCELED) {\n        this._value = _value;\n        this._cancelError = _cancelError;\n        this._weightedQueues = [];\n        this._weightedWaiters = [];\n    }\n    acquire(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve, reject) => {\n            if (!this._weightedQueues[weight - 1])\n                this._weightedQueues[weight - 1] = [];\n            this._weightedQueues[weight - 1].push({ resolve, reject });\n            this._dispatch();\n        });\n    }\n    runExclusive(callback, weight = 1) {\n        return __awaiter$2(this, void 0, void 0, function* () {\n            const [value, release] = yield this.acquire(weight);\n            try {\n                return yield callback(value);\n            }\n            finally {\n                release();\n            }\n        });\n    }\n    waitForUnlock(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        return new Promise((resolve) => {\n            if (!this._weightedWaiters[weight - 1])\n                this._weightedWaiters[weight - 1] = [];\n            this._weightedWaiters[weight - 1].push(resolve);\n            this._dispatch();\n        });\n    }\n    isLocked() {\n        return this._value <= 0;\n    }\n    getValue() {\n        return this._value;\n    }\n    setValue(value) {\n        this._value = value;\n        this._dispatch();\n    }\n    release(weight = 1) {\n        if (weight <= 0)\n            throw new Error(`invalid weight ${weight}: must be positive`);\n        this._value += weight;\n        this._dispatch();\n    }\n    cancel() {\n        this._weightedQueues.forEach((queue) => queue.forEach((entry) => entry.reject(this._cancelError)));\n        this._weightedQueues = [];\n    }\n    _dispatch() {\n        var _a;\n        for (let weight = this._value; weight > 0; weight--) {\n            const queueEntry = (_a = this._weightedQueues[weight - 1]) === null || _a === void 0 ? void 0 : _a.shift();\n            if (!queueEntry)\n                continue;\n            const previousValue = this._value;\n            const previousWeight = weight;\n            this._value -= weight;\n            weight = this._value + 1;\n            queueEntry.resolve([previousValue, this._newReleaser(previousWeight)]);\n        }\n        this._drainUnlockWaiters();\n    }\n    _newReleaser(weight) {\n        let called = false;\n        return () => {\n            if (called)\n                return;\n            called = true;\n            this.release(weight);\n        };\n    }\n    _drainUnlockWaiters() {\n        for (let weight = this._value; weight > 0; weight--) {\n            if (!this._weightedWaiters[weight - 1])\n                continue;\n            this._weightedWaiters[weight - 1].forEach((waiter) => waiter());\n            this._weightedWaiters[weight - 1] = [];\n        }\n    }\n}\n\nvar __awaiter$1 = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nclass Mutex {\n    constructor(cancelError) {\n        this._semaphore = new Semaphore(1, cancelError);\n    }\n    acquire() {\n        return __awaiter$1(this, void 0, void 0, function* () {\n            const [, releaser] = yield this._semaphore.acquire();\n            return releaser;\n        });\n    }\n    runExclusive(callback) {\n        return this._semaphore.runExclusive(() => callback());\n    }\n    isLocked() {\n        return this._semaphore.isLocked();\n    }\n    waitForUnlock() {\n        return this._semaphore.waitForUnlock();\n    }\n    release() {\n        if (this._semaphore.isLocked())\n            this._semaphore.release();\n    }\n    cancel() {\n        return this._semaphore.cancel();\n    }\n}\n\nvar __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nfunction withTimeout(sync, timeout, timeoutError = E_TIMEOUT) {\n    return {\n        acquire: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => __awaiter(this, void 0, void 0, function* () {\n                let isTimeout = false;\n                const handle = setTimeout(() => {\n                    isTimeout = true;\n                    reject(timeoutError);\n                }, timeout);\n                try {\n                    const ticket = yield sync.acquire(weight);\n                    if (isTimeout) {\n                        const release = Array.isArray(ticket) ? ticket[1] : ticket;\n                        release();\n                    }\n                    else {\n                        clearTimeout(handle);\n                        resolve(ticket);\n                    }\n                }\n                catch (e) {\n                    if (!isTimeout) {\n                        clearTimeout(handle);\n                        reject(e);\n                    }\n                }\n            }));\n        },\n        runExclusive(callback, weight) {\n            return __awaiter(this, void 0, void 0, function* () {\n                let release = () => undefined;\n                try {\n                    const ticket = yield this.acquire(weight);\n                    if (Array.isArray(ticket)) {\n                        release = ticket[1];\n                        return yield callback(ticket[0]);\n                    }\n                    else {\n                        release = ticket;\n                        return yield callback();\n                    }\n                }\n                finally {\n                    release();\n                }\n            });\n        },\n        release(weight) {\n            sync.release(weight);\n        },\n        cancel() {\n            return sync.cancel();\n        },\n        waitForUnlock: (weight) => {\n            if (weight !== undefined && weight <= 0) {\n                throw new Error(`invalid weight ${weight}: must be positive`);\n            }\n            return new Promise((resolve, reject) => {\n                const handle = setTimeout(() => reject(timeoutError), timeout);\n                sync.waitForUnlock(weight).then(() => {\n                    clearTimeout(handle);\n                    resolve();\n                });\n            });\n        },\n        isLocked: () => sync.isLocked(),\n        getValue: () => sync.getValue(),\n        setValue: (value) => sync.setValue(value),\n    };\n}\n\n// eslint-disable-next-lisne @typescript-eslint/explicit-module-boundary-types\nfunction tryAcquire(sync, alreadyAcquiredError = E_ALREADY_LOCKED) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return withTimeout(sync, 0, alreadyAcquiredError);\n}\n\nexport { E_ALREADY_LOCKED, E_CANCELED, E_TIMEOUT, Mutex, Semaphore, tryAcquire, withTimeout };\n","import { Mutex } from 'async-mutex';\n\nexport interface PiUser {\n  name: string;\n  [key: string]: any;\n}\n\nexport interface PaymentData {\n  amount: number;\n  memo: string;\n  metadata: Record<string, unknown>;\n}\n\n// TODO: Strongly type paymentDTO according to Pi SDK docs.\n\ndeclare global {\n  interface Window {\n    Pi: any;\n    RAILS_ENV?: string;\n  }\n  var Pi: any;\n}\n\nexport class PiSdkBase {\n  onConnection?: () => void;\n\n  static user: PiUser | null = null;\n  static connected: boolean = false;\n  static paymentBasePath: string = 'pi_payment';\n  static logPrefix: string = '[PiSDK]';\n  static version: string = \"2.0\";\n  static connectMutex: Mutex = new Mutex();\n  static accessToken: string | null = null;\n\n  constructor() {}\n\n  static get_connected(): boolean { return PiSdkBase.connected; }\n  static get_user(): PiUser | null { return PiSdkBase.user; }\n  static log(...args: unknown[]): void { console.log(this.logPrefix, ...args); }\n  static error(...args: unknown[]): void { console.error(this.logPrefix, ...args); }\n  initializePiSdkBase(): void { /* ... */ }\n\n  async connect(): Promise<void> {\n    const release = await PiSdkBase.connectMutex.acquire();\n    try {\n      if (PiSdkBase.connected && PiSdkBase.user) {\n        if (typeof this.onConnection == 'function') this.onConnection();\n        return;\n      }\n      if (!window.Pi || typeof window.Pi.init !== \"function\") {\n        PiSdkBase.error(\"Pi SDK not loaded.\");\n        return;\n      }\n      let piInitOptions: { version: string; sandbox?: boolean } = { version: PiSdkBase.version };\n      const backendEnv = (window.RAILS_ENV || (typeof process !== 'undefined' && (process.env?.RAILS_ENV || process.env?.NODE_ENV)) || \"development\");\n      if (backendEnv === \"development\" || backendEnv === \"test\") {\n        piInitOptions.sandbox = true;\n      }\n      // window.Pi is necessary for mocking\n      window.Pi.init(piInitOptions);\n      PiSdkBase.log(\"SDK initialized\", piInitOptions);\n      PiSdkBase.connected = false;\n      try {\n        // Window.Pi is necessary for mocking\n        const authResponse = await window.Pi.authenticate([\n          \"payments\", \"username\"\n        ], PiSdkBase.onIncompletePaymentFound);\n        PiSdkBase.accessToken = authResponse.accessToken;\n        PiSdkBase.user = authResponse.user;\n        PiSdkBase.connected = true;\n        PiSdkBase.log(\"Auth OK\", authResponse);\n        if (typeof this.onConnection == 'function') this.onConnection();\n      } catch (err) {\n        PiSdkBase.connected = false;\n        PiSdkBase.error(\"Auth failed\", err);\n      }\n    } finally { release(); }\n  }\n\n  static async postToServer(path: string, body: object): Promise<any> {\n    const base = this.paymentBasePath || PiSdkBase.paymentBasePath;\n    const resp = await fetch(`${base}/${path}`, {\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json'\n      },\n      body: JSON.stringify(body)\n    });\n    return resp.json();\n  }\n\n  static async onReadyForServerApproval(paymentId: string,\n\t\t\t\t\taccessToken: string): Promise<void> {\n    if (!paymentId) {\n      PiSdkBase.error(\"Approval: missing paymentId\");\n      return;\n    }\n    if (!accessToken) {\n      PiSdkBase.error(\"Approval: missing accessToken\");\n      return;\n    }\n    try {\n      const data = await PiSdkBase.postToServer(\"approve\", { paymentId,\n\t\t\t\t\t\t\t     accessToken });\n      PiSdkBase.log(\"approve:\", data);\n    }\n    catch (err) {\n      PiSdkBase.error(\"approve error\", err);\n    }\n  }\n\n  static async onReadyForServerCompletion(paymentId: string, transactionId: string): Promise<void> {\n    if (!paymentId || !transactionId) {\n      PiSdkBase.error(\"Completion: missing ids\");\n      return;\n    }\n    try {\n      const data = await PiSdkBase.postToServer(\"complete\", { paymentId,\n\t\t\t\t\t\t\t      transactionId });\n      PiSdkBase.log(\"complete:\", data);\n    }\n    catch (err) {\n      PiSdkBase.error(\"complete error\", err);\n    }\n  }\n\n  static async onCancel(paymentId: string): Promise<void> {\n    if (!paymentId) {\n      PiSdkBase.error(\"Cancel: missing paymentId\");\n      return;\n    }\n    try {\n      const data = await PiSdkBase.postToServer(\"cancel\", { paymentId });\n      PiSdkBase.log(\"cancel:\", data);\n    }\n    catch (err) {\n      PiSdkBase.error(\"cancel error\", err);\n    }\n  }\n\n  static async onError(error: string, paymentDTO: any): Promise<void> {\n    const paymentId = paymentDTO?.identifier;\n    if (!paymentId || !paymentDTO) {\n      PiSdkBase.error(\"Error: missing ids\", error, paymentDTO);\n      return;\n    }\n    try {\n      const data = await PiSdkBase.postToServer(\"error\", { paymentId, error });\n      PiSdkBase.log(\"error:\", data);\n    }\n    catch (err) {\n      PiSdkBase.error(\"error post\", err);\n    }\n  }\n\n  static async onIncompletePaymentFound(paymentDTO: any) {\n    const paymentId = paymentDTO?.identifier;\n    const transactionId = paymentDTO?.transaction?.txid || null;\n    if (!paymentId) {\n      PiSdkBase.error(\"Incomplete: missing paymentId\");\n      return;\n    }\n    try {\n      const data = await PiSdkBase.postToServer(\"incomplete\", { paymentId, transactionId });\n      PiSdkBase.log(\"incomplete:\", data);\n    }\n    catch (err) {\n      PiSdkBase.error(\"incomplete post error\", err);\n    }\n  }\n\n  /**\n   * Create a new payment request.\n   * @param {object} paymentData - Payment details.\n   * @param {number} paymentData.amount - Amount in Pi.\n   * @param {string} paymentData.memo - Payment memo.\n   * @param {object} paymentData.metadata - Optional metadata.\n   */\n  createPayment(paymentData: PaymentData): void {\n    if (!PiSdkBase.connected) {\n      PiSdkBase.error(\"Not connected to Pi.\");\n      return;\n    }\n    const { amount, memo, metadata } = paymentData || {};\n    if (typeof amount !== 'number' || !memo || typeof memo !== 'string' || !metadata || typeof metadata !== 'object' || Object.keys(metadata).length === 0) {\n      PiSdkBase.error(\"Invalid paymentData\", paymentData);\n      return;\n    }\n    const onReadyForServerApproval = (paymentId: string) => {\n      PiSdkBase.onReadyForServerApproval(paymentId, PiSdkBase.accessToken!);\n    };\n    Pi.createPayment(\n      paymentData,\n      {\n        \"onReadyForServerApproval\": onReadyForServerApproval,\n        \"onReadyForServerCompletion\": PiSdkBase.onReadyForServerCompletion,\n        \"onCancel\": PiSdkBase.onCancel,\n        \"onError\": PiSdkBase.onError,\n        \"onIncompletePaymentFound\": PiSdkBase.onIncompletePaymentFound\n      }\n    );\n  }\n}\n\nif (typeof window !== 'undefined') {\n  (window as any).PiSdkBase = PiSdkBase;\n}\n"],"names":["E_CANCELED","__awaiter$2","thisArg","_arguments","P","generator","adopt","value","resolve","reject","fulfilled","step","e","rejected","result","Semaphore","_value","_cancelError","weight","callback","release","queue","entry","_a","queueEntry","previousValue","previousWeight","called","waiter","__awaiter$1","Mutex","cancelError","releaser","_PiSdkBase","args","piInitOptions","backendEnv","authResponse","err","path","body","base","paymentId","accessToken","data","transactionId","error","paymentDTO","paymentData","amount","memo","metadata","onReadyForServerApproval","PiSdkBase"],"mappings":"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","x_google_ignoreList":[0]}